<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Nebula Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Nebula Blog Atom Feed"><title data-react-helmet="true">Custom Column - Instant UDF | Nebula</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://varchar-io.github.io/blog/2021/04/01/custom_column"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Custom Column - Instant UDF | Nebula"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-04-01T00:00:00.000Z"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://varchar-io.github.io/blog/2021/04/01/custom_column"><link data-react-helmet="true" rel="alternate" href="https://varchar-io.github.io/blog/2021/04/01/custom_column" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://varchar-io.github.io/blog/2021/04/01/custom_column" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ca62a3d1.css">
<link rel="preload" href="/assets/js/runtime~main.c29703cf.js" as="script">
<link rel="preload" href="/assets/js/main.583cd0b0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/nebula.svg" alt="Nebula Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/nebula.svg" alt="Nebula Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Nebula Docs</b></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/varchar-io/nebula" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/04/01/custom_column">Custom Column - Instant UDF</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/01/expression_udf_udaf">Expression, UDF, and UDAF</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/01/sketch">Sketch: extensible customized aggregation</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/01/web_ui">Web UI</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/09/01/bigint">BigInt Problem</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Custom Column - Instant UDF</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-04-01T00:00:00.000Z" itemprop="datePublished">April 1, 2021</time> Â· 3 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>Usually we saw data systems provide extensibility by allowing user to define functions - UDF, in Nebula, we allow user to define custom column instead, there are some reasons:</p><ul><li>custom column is simpler - for reuse purpose, user define functions and use function in transformation, there are more places to handle this customized behavior. Custom column allows us to sumply focus on extra column computing.</li><li>custom column is essential what user is looking for hence more straightforward. As mentioned above, most of time user defined function is for reuse purpose, however it is not a problem what Nebula tries to solve.</li><li>Nebula core problem here is to allow user to define transformation through literal language - <code>javascript</code>.</li><li>this aligns Nebula&#x27;s another goal to enable user to run simple distributed machine learning algorithm, custom column will be <code>feature extraction</code> in that use case.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="feature-support"></a>Feature Support<a class="hash-link" href="#feature-support" title="Direct link to heading">#</a></h2><p>Support custom column as extensibility used by Nebula in two scenarios, they are:</p><ul><li><p>Runtime compute - user provide custom column in query, and we compute this custom column value for it. In this scenario, column definition is logical, column value is computed on the fly by observers, no persistent required here hence this custom column is not included in the table schema definition.
for example: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">```</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // schema definition</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // table = ROW(a:int, b:long, c:string);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // custom column definition</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cc = () =&gt; nebula.column(&quot;a&quot;) * 2 + 3;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    nebula.register(&quot;cc&quot;, Types.INT, cc);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // use the custom column in query</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.select(&quot;cc&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Ingestion compute - user provides custom column hook in ingestion definition, it means original data source doesn&#x27;t have the column, but we define it by lambda. This new computed column during ingestion time will be persisted hence included in table schema.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">nebula.test:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    # max 10G RAM assigment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    max-mb: 10000</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    # max 10 days assignment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    max-hr: 240</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema: &quot;ROW&lt;id:int, price:double, price2:double&gt;&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    columns:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      id:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        bloom_filter: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      price2:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        expr: &quot;[price] * 2&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    time:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      type: static</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      # get it from linux by &quot;date +%s&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: 1565994194</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>  note that in this example, <code>[price]</code> is just a convenient expression, in runtime, it will be converted to a real function satifying a javascript function definition as <code>const price2 = () =&gt; nebula.column(&quot;price&quot;) * 2</code></p></li></ul><p>Internally, we&#x27;re supporting ES2015 syntax standard javascript expression, this should give users flexible enough space to transform data to whatever they want.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="more-to-expect"></a>More To Expect<a class="hash-link" href="#more-to-expect" title="Direct link to heading">#</a></h2><p>Nebula shall support custom aggregation column as well through <code>javascript</code> definition, however, it is a lot more work and we want to have a performant implementation of major aggregation functions, so this is not in the priority list for now.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/03/01/expression_udf_udaf"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Expression, UDF, and UDAF Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#feature-support" class="table-of-contents__link">Feature Support</a></li><li><a href="#more-to-expect" class="table-of-contents__link">More To Expect</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/nmZsXC53" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/varchario" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/varchar-io/nebula" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Columns AI, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c29703cf.js"></script>
<script src="/assets/js/main.583cd0b0.js"></script>
</body>
</html>